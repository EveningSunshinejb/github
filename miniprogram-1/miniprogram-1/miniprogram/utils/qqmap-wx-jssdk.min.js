var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ERROR_CONF={KEY_ERR:311,KEY_ERR_MSG:"key格式错误",PARAM_ERR:310,PARAM_ERR_MSG:"请求参数信息有误",SYSTEM_ERR:600,SYSTEM_ERR_MSG:"系统错误",WX_ERR_CODE:1000,WX_OK_CODE:200};var BASE_URL="https://apis.map.qq.com/ws/";var URL_SEARCH="geocoder/v1/";var URL_DISTANCE="distance/v1/";var URL_DIRECTION="direction/v1/";var MODE={driving:"driving",transit:"transit"};var EARTH_RADIUS=6378136.49;var Utils={location2query:function location2query(data){if(typeof data=="string"){return data}var query="";for(var i=0;i<data.length;i++){var d=data[i];if(!!query){query+=";"}if(d.location){query=query+d.location.lat+","+d.location.lng}if(d.latitude&&d.longitude){query=query+d.latitude+","+d.longitude}}return query},getLocationParam:function getLocationParam(location){if(typeof location=="string"){var locationArr=location.split(",");if(locationArr.length===2){location={latitude:location.split(",")[0],longitude:location.split(",")[1]}}else{location={}}}return location},getWXLocation:function getWXLocation(success,fail,complete){wx.getLocation({type:"gcj02",success:success,fail:fail,complete:complete})},polyfillParam:function polyfillParam(param){param.success=param.success||function(){};param.fail=param.fail||function(){};param.complete=param.complete||function(){}}};var QQMapWX=function(){function QQMapWX(options){_classCallCheck(this,QQMapWX);if(!options.key){throw Error("key值不能为空")}this.key=options.key}_createClass(QQMapWX,[{key:"reverseGeocoder",value:function reverseGeocoder(options){var that=this;options=options||{};Utils.polyfillParam(options);var location=Utils.getLocationParam(options.location);if(!location||!location.latitude||!location.longitude){var errconf=ERROR_CONF.PARAM_ERR;if(options.fail){options.fail(errconf)}if(options.complete){options.complete(errconf)}return}var requestParam={coord_type:options.coord_type||5,get_poi:options.get_poi||0,output:"json",key:that.key,location:location.latitude+","+location.longitude};wx.request({url:BASE_URL+URL_SEARCH,data:requestParam,header:{"content-type":"application/json"},method:"GET",success:function success(res){var data=res.data;if(res.statusCode===200){if(data.status===0){var result=data.result;var formatted_address=result.formatted_addresses.recommend;var address_component=result.address_component;if(options.success){options.success({status:0,message:"query ok",result:{location:location,formatted_address:formatted_address,address_component:address_component,address:formatted_address}})}}else{var _errconf=ERROR_CONF.SYSTEM_ERR;if(options.fail){options.fail(_errconf)}if(options.complete){options.complete(_errconf)}}}},fail:function fail(res){if(options.fail){options.fail(res)}},complete:function complete(res){if(options.complete){options.complete(res)}}})}},{key:"geocoder",value:function geocoder(options){var that=this;options=options||{};Utils.polyfillParam(options);if(!options.address){var errconf=ERROR_CONF.PARAM_ERR;if(options.fail){options.fail(errconf)}if(options.complete){options.complete(errconf)}return}var requestParam={address:options.address,output:"json",key:that.key};wx.request({url:BASE_URL+URL_SEARCH,data:requestParam,header:{"content-type":"application/json"},method:"GET",success:function success(res){var data=res.data;if(res.statusCode===200){if(data.status===0){var result=data.result;var location=result.location;if(options.success){options.success({status:0,message:"query ok",result:{location:location,address:result.address,formatted_address:result.formatted_addresses.recommend}})}}else{var errconf=ERROR_CONF.SYSTEM_ERR;if(options.fail){options.fail(errconf)}if(options.complete){options.complete(errconf)}}}},fail:function fail(res){if(options.fail){options.fail(res)}},complete:function complete(res){if(options.complete){options.complete(res)}}})}},{key:"getWXLocation",value:function getWXLocation(success,fail,complete){wx.getLocation({type:"gcj02",success:success,fail:fail,complete:complete})}}]);return QQMapWX}();module.exports=QQMapWX;